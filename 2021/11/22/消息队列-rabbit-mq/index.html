<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>
        博客主页
    </title>
    
<link rel="stylesheet" href="/libs/highlight/styles/monokai-sublime.css">

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/css/style.css">


    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?9a5aedba688e1818618f18178492e222";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="博客主页" type="application/atom+xml">
</head>

<body id="bodyx">
    <div class="hd posts">
    <a href="/index.html"><i class="fa fa-reply replay-btn" aria-hidden="true"></i></a>
    <div class="post-title">
        <p>
            消息队列
        </p>
        <hr>
    </div>
    <div class="post-content">
        <h2 id="什么是消息队列"><a href="#什么是消息队列" class="headerlink" title="什么是消息队列?"></a>什么是消息队列?</h2><p>通俗理解就是生产者用队列的方式发送消息，把要传输的数据放在队列中，消费者从队列中取出消息。</p>
<h2 id="为什么要引入消息队列-能解决什么问题"><a href="#为什么要引入消息队列-能解决什么问题" class="headerlink" title="为什么要引入消息队列?能解决什么问题?"></a>为什么要引入消息队列?能解决什么问题?</h2><p>消息队列是很重要的分布式中间件，能够应用于流量削峰填谷、应用间解耦、异步处理、消息通讯场景.</p>
<h3 id="流量削峰"><a href="#流量削峰" class="headerlink" title="流量削峰"></a>流量削峰</h3><p>很多电商网站都会搞整点秒杀的优惠活动，如果按照传统实现方案，通过传统方式进行秒杀下单，所有的查询创建在秒杀活动开始的时候一瞬间全都打到db server上面去，流量暴增,数据库立马就跪了,服务全跪。<br>显然传统方式是无法应对这种瞬时激增的流量的，那么这时候就要引入流量削峰的方案了，引入消息队列,所有的下单信息发送到消息队列中,并给定一个当前系统能承受的最大请求数量，当超过这个最大数量，多余的流量被丢弃,将被削掉流量的用户引导至错误页面,削峰完成,虽然丢失了一部分流量,但是保证了流量超出系统承受能力的时候，系统不至于崩溃.</p>
<h3 id="应用间解耦"><a href="#应用间解耦" class="headerlink" title="应用间解耦"></a>应用间解耦</h3><p>案例:系统A提供了一些数据，此时系统B对这些数据比较关注，此时的技术方案是A系统直接将数据通过接口调用发送给系统B,这时问题解决了,A系统成功为B系统提供了数据。</p>
<hr>
<p>存在的问题:</p>
<h4 id="系统A和系统B都存在宕机的可能性，服务的高可用性没有办法保证-通过接口调用的方式存在失败的可能性"><a href="#系统A和系统B都存在宕机的可能性，服务的高可用性没有办法保证-通过接口调用的方式存在失败的可能性" class="headerlink" title="系统A和系统B都存在宕机的可能性，服务的高可用性没有办法保证,通过接口调用的方式存在失败的可能性."></a>系统A和系统B都存在宕机的可能性，服务的高可用性没有办法保证,通过接口调用的方式存在失败的可能性.</h4><h4 id="如果这时又来了系统C-D-E-这时按照刚才的方案，系统A又需要调用系统C，D，E，这时候系统A的开发人员肯定要疯了-同样的逻辑要写3-4次"><a href="#如果这时又来了系统C-D-E-这时按照刚才的方案，系统A又需要调用系统C，D，E，这时候系统A的开发人员肯定要疯了-同样的逻辑要写3-4次" class="headerlink" title="如果这时又来了系统C,D,E,这时按照刚才的方案，系统A又需要调用系统C，D，E，这时候系统A的开发人员肯定要疯了,同样的逻辑要写3,4次."></a>如果这时又来了系统C,D,E,这时按照刚才的方案，系统A又需要调用系统C，D，E，这时候系统A的开发人员肯定要疯了,同样的逻辑要写3,4次.</h4><p>解决方案:<br>这时候如果使用消息队列,系统A的开发人员就解脱了，系统A只需要应用消息队列中的发布订阅模式,将数据简单地丢到消息队列中，对此数据关心的系统直接从消息队列中取出这份数据即可.</p>
<h3 id="异步处理"><a href="#异步处理" class="headerlink" title="异步处理"></a>异步处理</h3><p>案例:假设现在有一个简单的登录场景,假设进行登录的时候需要执行3个操作,调用user服务的查询用户接口A,记录访问日志存库操作B,发送推送消息操作C,这三个操作依次耗时20ms,30ms,50ms<br>如果同步处理的话那么在后端服务内的耗时至少是三个操作的总和,返给前端的时候还要计算上TCP连接建立的时间，实际上这个操作中，有一些操作是对于前端交互是毫无关系的,比如操作B和操作C，用户点击登录时<br>用户所关心的是立即登录，并不关心记录日志,发送推送消息这些操作,这些操作完全可以异步处理，非核心的业务逻辑或不要求立刻返回结果的任务完全可以异步执行，而这时就可以使用消息队列来完成这个操作。</p>
<h3 id="消息通讯"><a href="#消息通讯" class="headerlink" title="消息通讯"></a>消息通讯</h3><p>消息队列还可以应用于线程间通信或者进程间通信,或者应用于纯消息通讯,比如点对点的聊天，或者聊天室这种发布订阅模式。</p>

    </div>

<!--    -->
<!--        <hr class="fhr">-->
<!--        <div id="vcomments"></div>-->
<!--    -->
    <script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>
    <!-- 代码语言 -->
    <script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>
    <!-- 代码块复制 -->
    <script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
    <script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>
    <!-- 代码块收缩 -->
    <script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>
    <!-- 代码块折行 -->
    <style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>
</div>
    <div class="footer" id="footer">
    <p>Copyright © 2022 <a class="flink" target="_blank" rel="noopener" href="https://hexo.io">huang</a>-<a class="flink" target="_blank" rel="noopener" href="https://github.com/sanjinhub/hexo-theme-geek">wufeng</a>.
        <label class="el-switch el-switch-green el-switch-sm" style="vertical-align: sub;">
            <input type="checkbox" name="switch" id="update_style">
            <span class="el-switch-style"></span>
        </label>
<!--         <script type="text/javascript">
        var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
        document.write(unescape("%3Cspan id='cnzz_stat_icon_1278548644'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/stat.php%3Fid%3D1278548644%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
        </script> -->
    </p>
</div>
<input type="hidden" id="web_style" value="white">
<input type="hidden" id="valine_appid" value="CmCti21ooOOIzFOhEyFkFvR0-gzGzoHsz">
<input type="hidden" id="valine_appKey" value="FqiyUqbg7McKN2eG0MCewupf">

<script src="/libs/jquery.min.js"></script>


<script src="/libs/highlight/highlight.pack.js"></script>

<script src='//cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script>
<script src="//cdn1.lncld.net/static/js/2.5.0/av-min.js"></script>
<script type="text/javascript" src="https://web-stat.jiguang.cn/web-janalytics/scripts/janalytics-web.min.js"></script>


<script src="/js/js.js"></script>

<script>
    var APP_ID = '8mTMydGAfgjyyG7fj4ozdwJ5-gzGzoHsz';
    var APP_KEY = 'CELVKtxnkrXRKdAYF0hj9Vn7';
    console.log(111)
    AV.init({
        appId: APP_ID,
        appKey: APP_KEY
    });
    // 显示次数
    function showTime(Counter) {
        var query = new AV.Query("Counter");
        if($(".leancloud_visitors").length > 0){
            var url = $(".leancloud_visitors").attr('id').trim();
            // where field
            query.equalTo("words", url);
            // count
            query.count().then(function (number) {
                // There are number instances of MyClass where words equals url.
                $(document.getElementById(url)).text(number?  number : '--');
            }, function (error) {
                // error is an instance of AVError.
            });
        }
    }
    // 追加pv
    function addCount(Counter) {
        var url = $(".leancloud_visitors").length > 0 ? $(".leancloud_visitors").attr('id').trim() : 'icafebolger.com';
        var Counter = AV.Object.extend("Counter");
        var query = new Counter;
        query.save({
            words: url
        }).then(function (object) {
        })
    }
    $(function () {
        var Counter = AV.Object.extend("Counter");
        addCount(Counter);
        showTime(Counter);
    });


    window.JAnalyticsInterface.init({
        appkey: "d3ef0163897582b575891e20", // 极光官网中创建应用后分配的 appkey，必填
        debugMode: true,// 设置是否开启 debug 模式。true 则会打印更多的日志信息。设置 false 则只会输出 w、e 级别的日志
        channel: "default-channel",// 渠道名称，默认值为:default-channel
        loc: true, //设置是否尝试获取位置信息上报，默认为 true
        singlePage:false //设置是否为单页面，默认为 false
    });
</script>

<style type="text/css">
.v * {
    color: #698fca;
}

.v .vlist .vcard .vhead .vsys {
    color: #3a3e4a;
}

.v .vlist .vcard .vh .vmeta .vat {
    color: #638fd5;
}

.v .vlist .vcard .vhead .vnick {
    color: #6ba1ff;
}

.v a {
    color: #8696b1;
}

.v .vlist .vcard .vhead .vnick:hover {
    color: #669bfc;
}
</style>
</body>

</html>